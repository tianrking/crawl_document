### 令人抓狂的 JavaScript 混淆技术



#### 一 简介

我们在爬取网站的时候，经常会遇到各种各样类似加密的情形，比如：

```text
某个网站的 URL 带有一些看不懂的长串加密参数，想要抓取就必须要懂得这些参数是怎么构造的，否则我们连完整的 URL 都构造不出来，更不用说爬取了。
分析某个网站的 Ajax 接口的时候，可以看到接口的一些参数也是加密的，或者 Request Headers 里面也可能带有一些加密参数，如果不知道这些参数的具体构造逻辑就无法直接用程序来模拟这些 Ajax 请求。
翻看网站的 JavaScript 源代码，可以发现很多压缩了或者看不太懂的字符，比如 JavaScript 文件名被编码，JavaScript 的文件内容被压缩成几行，JavaScript 变量也被修改成单个字符或者一些十六进制的字符，导致我们不好轻易根据 JavaScript 找出某些接口的加密逻辑。

```

这些情况，基本上都是网站为了保护其本身的一些数据不被轻易抓取而采取的一些措施，我们可以把它归为两大类：

+ 接口加密技术：

  ![image-20211111150202079](C:\Users\Tuling\AppData\Roaming\Typora\typora-user-images\image-20211111150202079.png)

+ JavaScript 压缩、混淆和加密技术。



**JavaScript 压缩、混淆和加密技术**

对于网页来说，其逻辑是依赖于 JavaScript 来实现的，JavaScript 有如下特点：

+ JavaScript 代码运行于客户端，也就是它必须要在用户浏览器端加载并运行。
+ JavaScript 代码是公开透明的，也就是说浏览器可以直接获取到正在运行的 JavaScript 的源码。



**压缩、混淆、加密技术简述如下**

+ 代码压缩：即去除 JavaScript 代码中的不必要的空格、换行等内容，使源码都压缩为几行内容，降低代码可读性，当然同时也能提高网站的加载速度。

+ 代码混淆：使用变量替换、字符串阵列化、控制流平坦化、多态变异、僵尸函数、调试保护等手段，使代码变得难以阅读和分析，达到最终保护的目的。但这不影响代码原有功能。是理想、实用的 JavaScript 保护方案

+ 代码加密：可以通过某种手段将 JavaScript 代码进行加密，转成人无法阅读或者解析的代码，如将代码完全抽象化加密，如 eval 加密。另外还有更强大的加密技术，可以直接将 JavaScript 代码用 C/C++ 实现，JavaScript 调用其编译后形成的文件来执行相应的功能，如 Emscripten 还有 WebAssembly。

  

**JavaScript 混淆**
JavaScript 混淆完全是在 JavaScript 上面进行的处理，它的目的就是使得 JavaScript 变得难以阅读和分析，大大降低代码可读性，是一种很实用的 JavaScript 保护方案。

JavaScript 混淆技术主要有以下几种：

+ 变量混淆
  将带有含意的变量名、方法名、常量名随机变为无意义的类乱码字符串，降低代码可读性，如转成单个字符或十六进制字符串。

+ 字符串混淆
  将字符串阵列化集中放置、并可进行 MD5 或 Base64 加密存储，使代码中不出现明文字符串，这样可以避免使用全局搜索字符串的方式定位到入口点。

+ 属性加密
  针对 JavaScript 对象的属性进行加密转化，隐藏代码之间的调用关系。

+ 控制流平坦化
  打乱函数原有代码执行流程及函数调用关系，使代码逻变得混乱无序。

+ 僵尸代码
  随机在代码中插入无用的僵尸代码、僵尸函数，进一步使代码混乱。

+ 调试保护
  基于调试器特性，对当前运行环境进行检验，加入一些强制调试 debugger 语句，使其在调试模式下难以顺利执行 JavaScript 代码。

+ 多态变异
  使 JavaScript 代码每次被调用时，将代码自身即立刻自动发生变异，变化为与之前完全不同的代码，即功能完全不变，只是代码形式变异，以此杜绝代码被动态分析调试。

+ 锁定域名
  使 JavaScript 代码只能在指定域名下执行。

+ 反格式化
  如果对 JavaScript 代码进行格式化，则无法执行，导致浏览器假死。

+ 特殊编码
  将 JavaScript 完全编码为人不可读的代码，如表情符号、特殊表示内容等等。

总之，以上方案都是 JavaScript 混淆的实现方式，可以在不同程度上保护 JavaScript 代码。



#### 二 实操

安装node

官网：https://nodejs.org/en/download/

新建一个文件夹，比如feifei，随后进入该文件夹，初始化工作空间

```js
npm init
```

提示我们输入一些信息，创建一个 package.json 文件，这就完成了项目初始化了。

接下来我们来安装 javascript-obfuscator 这个库：

```js
npm install --save-dev javascript-obfuscator
npm install javascript-obfuscator -g
```

**代码压缩**

这里 javascript-obfuscator 也提供了代码压缩的功能，使用其参数 compact 即可完成 JavaScript 代码的压缩，输出为一行内容。默认是 true，如果定义为 false，则混淆后的代码会分行显示。

```js
const code = `
let x = '1' + 1
console.log('x', x)
`
const options = {
   compact: false
}
```

触发

```python
javascript-obfuscator  demo1.js  					# 默认形式
javascript-obfuscator  demo1.js --output b.js       # 指明文件输出
```



**变量名混淆**

变量名混淆可以通过配置 identifierNamesGenerator 参数实现，我们通过这个参数可以控制变量名混淆的方式，如 hexadecimal 则会替换为 16 进制形式的字符串，在这里我们可以设定如下值：

+ hexadecimal：将变量名替换为 16 进制形式的字符串，如 0xabc123。
+ mangled：将变量名替换为普通的简写字符，如 a、b、c 等。
  该参数默认为 hexadecimal。

我们将该参数修改为 mangled 来试一下：

```js
const code = `
let hello = '1' + 1
console.log('hello', hello)
`
const options = {

  compact: true,

  identifierNamesGenerator: 'mangled'

}

```

##### 字符串混淆

字符串混淆，即将一个字符串声明放到一个数组里面，使之无法被直接搜索到。我们可以通过控制 stringArray 参数来控制，默认为 true。

```js
const code = `
var a = 'hello world'
`;
const options = {
  compact: false,
  unicodeEscapeSequence: true  //对字符串进行 Unicode 转码
};
```

##### 控制流平坦化

控制流平坦化其实就是将代码的执行逻辑混淆，使其变得复杂难读。其基本思想是将一些逻辑处理块都统一加上一个前驱逻辑块，每个逻辑块都由前驱逻辑块进行条件判断和分发，构成一个个闭环逻辑，导致整个执行逻辑十分复杂难读。

我们通过 controlFlowFlattening 变量可以控制是否开启控制流平坦化，示例如下：

```js
const code = `
(function(){
    function foo () {
        return function () {
            var sum = 1 + 2;
            console.log(1);
            console.log(2);
            console.log(3);
            console.log(4);
            console.log(5);
            console.log(6);
        }
    }

    foo()();
})();
`
const options = {
  compact: false,
  controlFlowFlattening: true,
    controlFlowFlatteningThreshold:0.8
}
```





#### 三 原理简介

官网：https://obfuscator.io/

**原代码**

```js
function hi() {
  console.log("Hello World!");
}
hi();
```



**压缩**

```js
var _0x30bb = ['log', 'Hello\x20World!'];

(function (_0x38d89d, _0x30bbb2) {
    var _0xae0a32 = function (_0x2e4e9d) {
        while (--_0x2e4e9d) {
            _0x38d89d['push'](_0x38d89d['shift']());
        }
    };
    _0xae0a32(++_0x30bbb2);
}(_0x30bb, 0x153));

var _0xae0a = function (_0x38d89d, _0x30bbb2) {
    _0x38d89d = _0x38d89d - 0x0;
    var _0xae0a32 = _0x30bb[_0x38d89d];
    return _0xae0a32;
};

function hi() {
    console[_0xae0a('0x1')](_0xae0a('0x0'));
}

hi();
```

**解析**

![image-20210822153702262](C:\Users\Tuling\AppData\Roaming\Typora\typora-user-images\image-20210822153702262.png)



**还原**

```python
# encoding: utf-8
"""
@author: 夏洛
@QQ: 1972386194
@file: test.py
"""

import re
import execjs

func_js = """
// 直接用重组后的数组替换原来的数组
var _0x30bb = ["Hello World!", "log"]

// 解混淆用到的函数
var _0xae0a = function (_0x38d89d, _0x30bbb2) {
    _0x38d89d = _0x38d89d - 0x0;
    var _0xae0a32 = _0x30bb[_0x38d89d];
    return _0xae0a32;
};
"""

# 1.编译解混淆函数到node.js环境中
js_func_name = '_0xae0a'  # 混淆js中函数定义的名称
ctx = execjs.compile(func_js)
# 2.正则匹配出所有需要替换的函数
with open('j_obs.js') as f1:
    js = f1.read()

be_replaced_func_set = set(re.findall(js_func_name + "\([\s\S]+?\)",js))

print(be_replaced_func_set)
# 3.循环遍历进行替换
for be_replaced_func in be_replaced_func_set:
    args_tuple = re.findall("\(([\s\S]+?)\)", be_replaced_func)[0]
    args0 = eval(args_tuple.split(',')[0]) # 截取参数

    res = ctx.call(js_func_name, args0) # 调用参数，获取返回值
    js = js.replace(be_replaced_func, "'" + res + "'")
    print('{} 替换完成'.format(res))

with open('code.js', 'w') as f2: # 重写JS输出
    js = f2.write(js)

```





#### 四 OB混淆实践

**4.1 OB 混淆案例**

https://dynamic6.scrape.center/

**4.2 详情数据**

https://dynamic6.scrape.center/api/movie/?limit=10&offset=0&token=ZDlkNzc0OGQ5OTg1OGNjY2M1MmQxNTI1NDExYTY0YjdiMTNkNjE0ZiwxNjI5Nzg2OTI3



**4.3 全局搜索看数据**

![image-20210824143904072](C:\Users\Tuling\AppData\Roaming\Typora\typora-user-images\image-20210824143904072.png)



**4.4 调试参数**



![image-20210824145033874](C:\Users\Tuling\AppData\Roaming\Typora\typora-user-images\image-20210824145033874.png)

加密逻辑

![image-20210824145827316](C:\Users\Tuling\AppData\Roaming\Typora\typora-user-images\image-20210824145827316.png)



流程梳理

+ 传入的 /api/movie 会构造一个初始化列表，变量命名为 _0x3dde76。

+ 获取当前的时间戳，命名为 _0x4c50b4，push 到 _0x3dde76 这个变量里面。

+ 将 _0x3dde76 变量用“,”拼接，然后进行 SHA1 编码，命名为 _0x46ba68。

+ 将 _0x46ba68 （SHA1 编码的结果）和 _0x4c50b4 （时间戳）用逗号拼接，命名为 _0x495a44。

+ 将 _0x495a44 进行 Base64 编码，命名为 _0x2a93f2，得到最后的 token。



python代码实现

```python
import hashlib
import time
import base64
from typing import List, Any
import requests
url = 'https://dynamic6.scrape.center/api/movie?limit={limit}&offset={offset}&token={token}'
LIMIT = 10
OFFSET = 0

def get_token(args: List[Any]):
    timestamp = str(int(time.time()))
    args.append(timestamp)  # 添加时间
    sign = hashlib.sha1(','.join(args).encode('utf-8')).hexdigest()  # 通过sha1编码参数
    _0x3ea520 = base64.b64encode(','.join([sign, timestamp]).encode('utf-8')).decode('utf-8')
    print(_0x3ea520)
    return _0x3ea520

args = ['/api/movie']
token = get_token(args=args)
_url = url.format(limit=LIMIT, offset=OFFSET, token=token)
print(_url)
response = requests.get(_url)
print('response', response.json())

```



#### 五 案例实践



猿人学第16题：https://match.yuanrenxue.com/match/16

参数加密：m

![image-20210822190831932](C:\Users\Tuling\AppData\Roaming\Typora\typora-user-images\image-20210822190831932.png)

入口

![image-20210822190852116](C:\Users\Tuling\AppData\Roaming\Typora\typora-user-images\image-20210822190852116.png)



##### 4.1 参数调整

```js
n[e(528)](btoa, p_s)

t[e(530)] = function(e, t) {
    return e + t
}
# 类似于
btoa(p_s)  # p_s 就是时间戳 "1629630384000"

Date['parse'](new Date).toString())
```



开始补环境代码

##### 4.2 追 btoa

![image-20210823154455931](C:\Users\Tuling\AppData\Roaming\Typora\typora-user-images\image-20210823154455931.png)



直接拉数组

![image-20210823154623284](C:\Users\Tuling\AppData\Roaming\Typora\typora-user-images\image-20210823154623284.png)



##### 4.3 补数组，防止检测这里可以压缩一下

官网：https://www.sojson.com/jshtml.html

![image-20210823155612497](C:\Users\Tuling\AppData\Roaming\Typora\typora-user-images\image-20210823155612497.png)



测试环境，能输出btoa就表示成功

![image-20210823155711411](C:\Users\Tuling\AppData\Roaming\Typora\typora-user-images\image-20210823155711411.png)



调试一下

```js
console.log(window[u(208)](Date['parse'](new Date).toString()))

// console.log(window.btoa((Date['parse'](new Date).toString())));
```

##### 4.4 补f参数

```js
 var f = u(191) + u(204) + u(258) + u(199) + "WVUTSRQPON" + u(189) + u(232) + u(222) + u(217) + u(197) + "ZXYWVUTSRQPONABHICES" + u(223);
```

##### 4.5 补d参数

![image-20210823161927095](C:\Users\Tuling\AppData\Roaming\Typora\typora-user-images\image-20210823161927095.png)

##### 4.6 补 md5参数

##### 4.7 补n参数、补数组



##### 4.8 python代码编写

调用JS出现BUG

![image-20210823165400981](C:\Users\Tuling\AppData\Roaming\Typora\typora-user-images\image-20210823165400981.png)



##### 4.9 继续调试 

移除这个地方

![image-20210823165458284](C:\Users\Tuling\AppData\Roaming\Typora\typora-user-images\image-20210823165458284.png)



4.9.1

完整JS代码

```js

window = global;

ff = function(value){

var r,o,a,s;_0x34e7=["AqLWq","0zyxwvutsr","TKgNw","eMnqD","thjIz","btoa","MNPQRSTWXY","oPsqh","niIlq","evetF","LVZVH","fYWEX","kmnprstwxy","aYkvo","tsrqpomnlk","HfLqY","aQCDK","lGBLj","test","3210zyxwvu","QWK2Fi",'return /" ',"hsJtK","jdwcO","SlFsj","OWUOc","LCaAn","[^ ]+)+)+[","FAVYf","2Fi+987654","floor","join","EuwBW","OXYrZ","charCodeAt","SkkHG","iYuJr","GwoYF","kPdGe","cVCcp","INQRH","INVALID_CH","charAt","push","apply","lalCJ","kTcRS",'+ this + "',"ykpOn","gLnjm","gmBaq","kukBH","dvEWE","SFKLi","^([^ ]+( +","qpomnlkjih","^ ]}","pHtmC","length","split","ABHICESQWK","FKByN","U987654321","lmHcG","dICfr","Szksx","Bgrij","iwnNJ","jihgfdecba","GfTek","gfdecbaZXY","constructo","QIoXW","jLRMs"],a=_0x34e7,s=function(e){for(;--e;)a.push(a.shift())},(o=(r={data:{key:"cookie",value:"timeout"},setCookie:function(e,t,n,r){r=r||{};for(var i=t+"="+n,o=0,a=e.length;o<a;o++){var s=e[o];i+="; "+s;var l=e[s];e.push(l),a=e.length,!0!==l&&(i+="="+l)}r.cookie=i},removeCookie:function(){return"dev"},getCookie:function(e,t){var n,r=(e=e||function(e){return e})(new RegExp("(?:^|; )"+t.replace(/([.$?*|{}()[]\/+^])/g,"$1")+"=([^;]*)"));return n=133,s(++n),r?decodeURIComponent(r[1]):void 0},updateCookie:function(){return new RegExp("\\w+ *\\(\\) *{\\w+ *['|\"].+['|\"];? *}").test(r.removeCookie.toString())}}).updateCookie())?o?r.getCookie(null,"counter"):r.removeCookie():r.setCookie(["*"],"counter",1);

var l = function(e, t) {
        return _0x34e7[e -= 188]
    }, u = l
var f = u(191) + u(204) + u(258) + u(199) + "WVUTSRQPON" + u(189) + u(232) + u(222) + u(217) + u(197) + "ZXYWVUTSRQPONABHICES" + u(223);

var e, t;
    _0x4c28 = ["18|38|15|2", "ucisR", "wWwRM", "LzcOo", "yWGcu", "PlAEw", "ihcci", "hBKtU", "rvloG", "xcQTI", "uhJgH", "vRqUp", "EQEzR", "abc", "QgSUn", "0|45|44|19", "WMqBp", "koePJ", "jGSEC", "IKbhW", "wEOgn", "|49|71|11|", "xgzfr", "ABCDEF", "DdHPB", "aFxRD", "sFtiw", "concat", "YhaCC", "YVBwM", "abYok", "2|28|6|36|", "NLOsy", "bRLIN", "xGAWc", "length", "zYRlD", "14|67|61|3", "bolvy", "pagBT", "mdsJQ", "4|69|41|26", "kaXPV", "IWxBE", "pviAr", "5|0|2", "lvwPz", "YcDFe", "yGmJD", "FcYqi", "AAZoR", "|46|5|3|50", "PnITs", "ABCDEFGHIJ", "charCodeAt", "KLMNOPQRST", "prrXX", "FDiNG", "split", "oBesn", "9|24|10|56", "VaXsK", "fromCharCo", "FDfcp", "rrdPR", "HHkBN", "89+/", "mfuQZ", "PbrnX", "FcXlo", "rNapo", "fEXNi", "qtIDJ", "60|53|21|5", "Rtsed", "SUrST", "nsaps", "vyNVU", "2|29|23|64", "0|43|57|4|", "NNXUu", "nCrbn", "wQPIq", "XBcOb", "39|40|47|6", "ljkOt", "yMPhx", "TXzzv", "0123456789", "fmdcS", "iXQwu", "grCxb", "3|6|1|4|7|", "wKeAM", "Iekey", "opqrstuvwx", "|7|17", "BQgZQ", "BtzmV", "jZUAt", "HYhpy", "Yvoqt", "VyzBI", "NNVLf", "dbmfK", "0|58|16|32", "UAFHv", "WNIsZ", "2|1|4|3|5|", "JFqRJ", "zObVA", "d24fb0d696", "XfWkD", "MFmWH", "lZISZ", "WzbFA", "kaQlD", "3f7d28e17f", "eSwEi", "YpeFX", "kZhzK", "KxKIe", "LAIPf", "LjyKQ", "YLwOK", "iqfMz", "51|8|0|65|", "JRihE", "nqEyg", "|37|22|27|", "ZXsFi", "goEwl", "|31|63|48|", "wvVCN", "wnDlW", "Myvqp", "UlhBp", "fwCDC", "charAt", "Lmhlz", "WQCAS", "UXeVn", "KIXRL", "HiEZt", "WNzfT", "lNWda", "tsNzQ"],
    e = _0x4c28,
    t = 368,
    function(t) {
        for (; --t; )
            e.push(e.shift())
    }(++t);

var n = function(e, t) {
                return _0x4c28[e -= 0]
            };

md5 = function(e) {
                var t = n
                  , r = {
                    fEXNi: function(e, t) {
                        return e(t)
                    },
                    LzcOo: function(e, t, n) {
                        return e(t, n)
                    }
                };
                r[t(3)] = function(e, t) {
                    return e(t)
                }
                ,
                r.wEOgn = function(e, t, n) {
                    return e(t, n)
                }
                ,
                r[t(120)] = function(e, t, n) {
                    return e(t, n)
                }
                ,
                r[t(69)] = function(e, t) {
                    return e == t
                }
                ,
                r[t(109)] = function(e, t) {
                    return e(t)
                }
                ,
                r[t(112)] = t(86),
                r.oBesn = "900150983c" + t(37) + t(43) + "72",
                r[t(70)] = t(18) + t(118),
                r[t(16)] = function(e, t) {
                    return e < t
                }
                ,
                r[t(2)] = t(110) + t(5) + t(133) + "|55|13|12|" + t(146) + t(114) + t(94) + "35|68|33|4" + t(104) + t(52) + t(73) + t(88) + t(55) + "25|34|1|2|" + t(10) + t(4) + t(124) + t(58) + "52|59|66|7" + t(31) + t(22),
                r[t(53)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(35)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(141)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(91)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(65)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(38)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(19)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(117)] = function(e, t, n) {
                    return e(t, n)
                }
                ,
                r[t(92)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(82)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(111)] = function(e, t, n) {
                    return e(t, n)
                }
                ,
                r[t(78)] = function(e, t) {
                    return e + t
                }
                ,
                r.lZISZ = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r.Iekey = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r.AAZoR = function(e, t) {
                    return e + t
                }
                ,
                r[t(67)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r.UlhBp = function(e, t) {
                    return e + t
                }
                ,
                r.yMPhx = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(138)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(121)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(98)] = function(e, t, n) {
                    return e(t, n)
                }
                ,
                r.kHuTw = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(50)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(142)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(87)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(90)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(59)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(28)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(119)] = function(e, t) {
                    return e + t
                }
                ,
                r.YpeFX = function(e, t) {
                    return e + t
                }
                ,
                r[t(7)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r.prrXX = function(e, t) {
                    return e + t
                }
                ,
                r.kaQlD = function(e, t) {
                    return e + t
                }
                ,
                r.qtIDJ = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r.xGAWc = function(e, t) {
                    return e + t
                }
                ,
                r[t(134)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(89)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(15)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(9)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(56)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(6)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(32)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(99)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(39)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(113)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(106)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(66)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r.TXzzv = function(e, t) {
                    return e + t
                }
                ,
                r.NNVLf = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(79)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(1)] = function(e, t, n, r, i, o, a, s) {
                    return e(t, n, r, i, o, a, s)
                }
                ,
                r[t(81)] = function(e, t) {
                    return e + t
                }
                ,
                r.MXnIN = function(e, t) {
                    return e >> t
                }
                ,
                r[t(23)] = function(e, t) {
                    return e << t
                }
                ,
                r.nqEyg = function(e, t) {
                    return e % t
                }
                ,
                r.kaXPV = function(e, t) {
                    return e >>> t
                }
                ,
                r[t(24)] = function(e, t, n) {
                    return e(t, n)
                }
                ,
                r[t(44)] = function(e, t, n) {
                    return e(t, n)
                }
                ,
                r[t(30)] = function(e, t, n) {
                    return e(t, n)
                }
                ,
                r[t(143)] = function(e, t) {
                    return e | t
                }
                ,
                r[t(101)] = function(e, t) {
                    return e & t
                }
                ,
                r[t(122)] = function(e, t, n, r, i, o, a) {
                    return e(t, n, r, i, o, a)
                }
                ,
                r.ZpUiH = function(e, t) {
                    return e & t
                }
                ,
                r[t(72)] = function(e, t) {
                    return e ^ t
                }
                ,
                r[t(130)] = function(e, t) {
                    return e ^ t
                }
                ,
                r[t(41)] = function(e, t) {
                    return e | t
                }
                ,
                r[t(116)] = function(e, t) {
                    return e > t
                }
                ,
                r[t(80)] = function(e, t) {
                    return e(t)
                }
                ,
                r[t(33)] = function(e, t, n) {
                    return e(t, n)
                }
                ,
                r[t(83)] = function(e, t) {
                    return e(t)
                }
                ,
                r[t(60)] = function(e, t) {
                    return e + t
                }
                ,
                r.FDfcp = function(e, t) {
                    return e * t
                }
                ,
                r[t(95)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(51)] = function(e, t) {
                    return e & t
                }
                ,
                r.DdHPB = function(e, t) {
                    return e >> t
                }
                ,
                r.abYok = function(e, t) {
                    return e | t
                }
                ,
                r[t(84)] = function(e, t) {
                    return e << t
                }
                ,
                r[t(105)] = function(e, t) {
                    return e & t
                }
                ,
                r[t(8)] = function(e, t) {
                    return e - t
                }
                ,
                r[t(137)] = function(e) {
                    return e()
                }
                ,
                r.YVBwM = function(e, t) {
                    return e << t
                }
                ,
                r[t(27)] = function(e, t) {
                    return e & t
                }
                ,
                r[t(26)] = function(e, t) {
                    return e / t
                }
                ,
                r[t(74)] = function(e, t) {
                    return e * t
                }
                ,
                r[t(49)] = t(14) + "abcdef",
                r[t(36)] = function(e, t) {
                    return e >> t
                }
                ,
                r[t(46)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(75)] = function(e, t) {
                    return e >> t
                }
                ,
                r[t(47)] = function(e, t) {
                    return e * t
                }
                ,
                r[t(11)] = t(126) + t(128) + "UVWXYZabcdefghijklmn" + t(21) + "yz01234567" + t(139),
                r[t(63)] = function(e, t) {
                    return e * t
                }
                ,
                r.KIXRL = function(e, t) {
                    return e << t
                }
                ,
                r[t(57)] = function(e, t) {
                    return e % t
                }
                ,
                r[t(77)] = function(e, t) {
                    return e << t
                }
                ,
                r[t(71)] = function(e, t) {
                    return e >> t
                }
                ,
                r.jZUAt = function(e, t) {
                    return e >> t
                }
                ,
                r[t(48)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(17)] = function(e, t) {
                    return e % t
                }
                ,
                r[t(85)] = function(e, t) {
                    return e * t
                }
                ,
                r[t(61)] = function(e, t) {
                    return e < t
                }
                ,
                r.mfuQZ = function(e, t) {
                    return e + t
                }
                ,
                r[t(125)] = function(e, t) {
                    return e * t
                }
                ,
                r[t(0)] = function(e, t) {
                    return e(t)
                }
                ;
                var i = r;
                function o(e, n) {
                    for (var r = t, o = i.WNzfT[r(131)]("|"), a = 0; ; ) {
                        switch (o[a++]) {
                        case "0":
                            for (var d = 0; i.iXQwu(d, e.length); d += 16)
                                for (var p = i[r(2)][r(131)]("|"), h = 0; ; ) {
                                    switch (p[h++]) {
                                    case "0":
                                        w = i[r(53)](l, w, b, x, T, e[d + 2], 9, -51403784);
                                        continue;
                                    case "1":
                                        x = u(x, T, w, b, e[d + 6], 23, 76029189);
                                        continue;
                                    case "2":
                                        b = i[r(53)](u, b, x, T, w, e[i.JFqRJ(d, 9)], 4, -640364487);
                                        continue;
                                    case "3":
                                        T = i[r(141)](c, T, w, b, x, e[d + 10], 15, -1051523);
                                        continue;
                                    case "4":
                                        T = s(T, w, b, x, e[i.JFqRJ(d, 2)], 17, 606105819);
                                        continue;
                                    case "5":
                                        w = i[r(91)](c, w, b, x, T, e[i[r(65)](d, 3)], 10, -1894446606);
                                        continue;
                                    case "6":
                                        w = i.XfWkD(l, w, b, x, T, e[i.wKeAM(d, 14)], 9, -1019803690);
                                        continue;
                                    case "7":
                                        T = i.pviAr(f, T, v);
                                        continue;
                                    case "8":
                                        b = i.XfWkD(l, b, x, T, w, e[i[r(92)](d, 13)], 5, -1444681467);
                                        continue;
                                    case "9":
                                        x = i[r(38)](s, x, T, w, b, e[i[r(82)](d, 3)], 22, -1044525330);
                                        continue;
                                    case "10":
                                        w = s(w, b, x, T, e[i[r(82)](d, 5)], 12, 1200080426);
                                        continue;
                                    case "11":
                                        x = i[r(38)](l, x, T, w, b, e[i[r(82)](d, 0)], 20, -373897302);
                                        continue;
                                    case "12":
                                        w = i[r(38)](s, w, b, x, T, e[i[r(82)](d, 9)], 12, -1958435417);
                                        continue;
                                    case "13":
                                        b = i.XfWkD(s, b, x, T, w, e[i.xcQTI(d, 8)], 7, 1770035416);
                                        continue;
                                    case "14":
                                        var m = b;
                                        continue;
                                    case "15":
                                        w = i[r(38)](u, w, b, x, T, e[i.xcQTI(d, 8)], 11, -2022574463);
                                        continue;
                                    case "16":
                                        b = f(b, m);
                                        continue;
                                    case "17":
                                        w = i[r(111)](f, w, g);
                                        continue;
                                    case "18":
                                        x = l(x, T, w, b, e[i[r(78)](d, 12)], 20, -1921207734);
                                        continue;
                                    case "19":
                                        w = i[r(40)](u, w, b, x, T, e[d + 4], 11, 1272893353);
                                        continue;
                                    case "20":
                                        T = i[r(20)](u, T, w, b, x, e[i.PlAEw(d, 11)], 16, 1839030562);
                                        continue;
                                    case "21":
                                        b = s(b, x, T, w, e[i[r(123)](d, 12)], 7, 1804550682);
                                        continue;
                                    case "22":
                                        x = u(x, T, w, b, e[i[r(123)](d, 10)], 23, -1094730640);
                                        continue;
                                    case "23":
                                        T = i[r(67)](c, T, w, b, x, e[d + 14], 15, -1416354905);
                                        continue;
                                    case "24":
                                        b = s(b, x, T, w, e[i[r(123)](d, 4)], 7, -176418897);
                                        continue;
                                    case "25":
                                        w = i.UXeVn(u, w, b, x, T, e[d + 0], 11, -358537222);
                                        continue;
                                    case "26":
                                        b = i.UXeVn(l, b, x, T, w, e[i[r(62)](d, 1)], 5, -165796510);
                                        continue;
                                    case "27":
                                        b = i.UXeVn(u, b, x, T, w, e[i[r(62)](d, 13)], 4, 681279174);
                                        continue;
                                    case "28":
                                        b = i[r(12)](l, b, x, T, w, e[i[r(138)](d, 9)], 5, 568446438);
                                        continue;
                                    case "29":
                                        w = i.yMPhx(c, w, b, x, T, e[d + 7], 10, 11261161415);
                                        continue;
                                    case "30":
                                        var g = w;
                                        continue;
                                    case "31":
                                        b = c(b, x, T, w, e[i.yGmJD(d, 8)], 6, 1873313359);
                                        continue;
                                    case "32":
                                        x = i.aFxRD(f, x, y);
                                        continue;
                                    case "33":
                                        T = i[r(12)](l, T, w, b, x, e[i[r(121)](d, 15)], 14, -660478335);
                                        continue;
                                    case "34":
                                        T = i.kHuTw(u, T, w, b, x, e[d + 3], 16, -722881979);
                                        continue;
                                    case "35":
                                        b = i[r(50)](l, b, x, T, w, e[i[r(121)](d, 5)], 5, -701520691);
                                        continue;
                                    case "36":
                                        T = l(T, w, b, x, e[i[r(121)](d, 3)], 14, -187363961);
                                        continue;
                                    case "37":
                                        T = i[r(142)](u, T, w, b, x, e[i.QgSUn(d, 7)], 16, -155497632);
                                        continue;
                                    case "38":
                                        b = i.FcXlo(u, b, x, T, w, e[i.koePJ(d, 5)], 4, -378558);
                                        continue;
                                    case "39":
                                        w = i[r(142)](u, w, b, x, T, e[i[r(90)](d, 12)], 11, -421815835);
                                        continue;
                                    case "40":
                                        T = i[r(59)](u, T, w, b, x, e[i[r(28)](d, 15)], 16, 530742520);
                                        continue;
                                    case "41":
                                        x = i.wvVCN(s, x, T, w, b, e[d + 15], 22, 1236531029);
                                        continue;
                                    case "42":
                                        x = i[r(59)](l, x, T, w, b, e[i[r(119)](d, 4)], 20, -405537848);
                                        continue;
                                    case "43":
                                        b = i[r(59)](s, b, x, T, w, e[i.lvwPz(d, 0)], 7, -680976936);
                                        continue;
                                    case "44":
                                        b = i[r(59)](u, b, x, T, w, e[i[r(45)](d, 1)], 4, -1530992060);
                                        continue;
                                    case "45":
                                        x = i.nCrbn(u, x, T, w, b, e[i[r(129)](d, 14)], 23, -35311556);
                                        continue;
                                    case "46":
                                        b = c(b, x, T, w, e[i[r(42)](d, 12)], 6, 1700485571);
                                        continue;
                                    case "47":
                                        x = i[r(7)](u, x, T, w, b, e[i.kaQlD(d, 2)], 23, -995338651);
                                        continue;
                                    case "48":
                                        T = c(T, w, b, x, e[d + 6], 15, -1560198380);
                                        continue;
                                    case "49":
                                        w = i[r(145)](l, w, b, x, T, e[i[r(107)](d, 6)], 9, -1069501632);
                                        continue;
                                    case "50":
                                        x = i[r(134)](c, x, T, w, b, e[i[r(89)](d, 1)], 21, -2054922799);
                                        continue;
                                    case "51":
                                        x = i.fmdcS(l, x, T, w, b, e[d + 8], 20, 1163531501);
                                        continue;
                                    case "52":
                                        x = i[r(15)](c, x, T, w, b, e[i[r(9)](d, 13)], 21, 1309151649);
                                        continue;
                                    case "53":
                                        x = i[r(15)](s, x, T, w, b, e[i[r(56)](d, 11)], 22, -1990404162);
                                        continue;
                                    case "54":
                                        w = i[r(6)](s, w, b, x, T, e[i[r(32)](d, 13)], 12, -40341101);
                                        continue;
                                    case "55":
                                        x = i.sFtiw(s, x, T, w, b, e[i.UAFHv(d, 7)], 22, -45705983);
                                        continue;
                                    case "56":
                                        T = i.sFtiw(s, T, w, b, x, e[i.MFmWH(d, 6)], 17, -1473231341);
                                        continue;
                                    case "57":
                                        w = i[r(99)](s, w, b, x, T, e[i.MFmWH(d, 1)], 12, -389564586);
                                        continue;
                                    case "58":
                                        x = c(x, T, w, b, e[i[r(39)](d, 9)], 21, -343485551);
                                        continue;
                                    case "59":
                                        b = i[r(113)](c, b, x, T, w, e[i[r(39)](d, 4)], 6, -145523070);
                                        continue;
                                    case "60":
                                        T = i.bRLIN(s, T, w, b, x, e[i[r(39)](d, 10)], 17, -42063);
                                        continue;
                                    case "61":
                                        var v = T;
                                        continue;
                                    case "62":
                                        b = i[r(66)](c, b, x, T, w, e[d + 0], 6, -198630844);
                                        continue;
                                    case "63":
                                        w = i[r(66)](c, w, b, x, T, e[i[r(13)](d, 15)], 10, -30611744);
                                        continue;
                                    case "64":
                                        x = c(x, T, w, b, e[d + 5], 21, -57434055);
                                        continue;
                                    case "65":
                                        T = i[r(29)](l, T, w, b, x, e[i[r(13)](d, 7)], 14, 1735328473);
                                        continue;
                                    case "66":
                                        w = i[r(29)](c, w, b, x, T, e[i[r(79)](d, 11)], 10, -1120210379);
                                        continue;
                                    case "67":
                                        var y = x;
                                        continue;
                                    case "68":
                                        w = i[r(1)](l, w, b, x, T, e[d + 10], 9, 38016083);
                                        continue;
                                    case "69":
                                        T = i[r(1)](s, T, w, b, x, e[i[r(79)](d, 14)], 17, -1502002290);
                                        continue;
                                    case "70":
                                        T = i.SUrST(c, T, w, b, x, e[i[r(79)](d, 2)], 15, 718787259);
                                        continue;
                                    case "71":
                                        T = l(T, w, b, x, e[i[r(81)](d, 11)], 14, 643717713);
                                        continue
                                    }
                                    break
                                }
                            continue;
                        case "1":
                            var b = 1732584193;
                            continue;
                        case "2":
                            return Array(b, x, T, w);
                        case "3":
                            e[i.MXnIN(n, 5)] |= i[r(23)](128, i[r(54)](n, 32));
                            continue;
                        case "4":
                            var x = -271733879;
                            continue;
                        case "5":
                            var w = 271733878;
                            continue;
                        case "6":
                            e[i.BQgZQ(i[r(115)](n + 64, 9), 4) + 14] = n;
                            continue;
                        case "7":
                            var T = -1732584194;
                            continue
                        }
                        break
                    }
                }
                function a(e, n, r, o, a, s) {
                    var l = t;
                    return f(i.BtzmV(d, i[l(44)](f, i.dbmfK(f, n, e), i[l(30)](f, o, s)), a), r)
                }
                function s(e, n, r, o, s, l, u) {
                    var c = t;
                    return a(i[c(143)](i[c(101)](n, r), i[c(101)](~n, o)), e, n, s, l, u)
                }
                function l(e, n, r, o, s, l, u) {
                    var c = t;
                    return i[c(122)](a, i[c(143)](i.ZpUiH(n, o), i.ZpUiH(r, ~o)), e, n, s, l, u)
                }
                function u(e, n, r, o, s, l, u) {
                    return i[t(122)](a, i.tsNzQ(n ^ r, o), e, n, s, l, u)
                }
                function c(e, n, r, o, s, l, u) {
                    var c = t;
                    return i[c(122)](a, i[c(130)](r, i[c(41)](n, ~o)), e, n, s, l, u)
                }
                function f(e, n) {
                    var r = t
                      , o = i[r(95)](65535 & e, i.iqfMz(n, 65535))
                      , a = i[r(95)](e >> 16, i[r(97)](n, 16)) + i[r(97)](o, 16);
                    return i[r(103)](i[r(84)](a, 16), i[r(105)](o, 65535))
                }
                function d(e, n) {
                    var r = t;
                    return i.abYok(e << n, e >>> i[r(8)](32, n))
                }
                function p(e) {
                    for (var n = t, r = i[n(137)](Array), o = i[n(8)](i.vRqUp(1, 16), 1), a = 0; a < i.FDfcp(e[n(108)], 16); a += 16)
                        r[i[n(97)](a, 5)] |= i[n(102)](i[n(27)](e[n(127)](i[n(26)](a, 16)), o), i[n(54)](a, 32));
                    return r
                }
                function h(e) {
                    for (var n = t, r = i[n(49)], o = "", a = 0; i.iXQwu(a, i[n(74)](e[n(108)], 4)); a++)
                        o += i.xgzfr(r[n(64)](15 & i[n(36)](e[i[n(36)](a, 2)], i[n(46)](i[n(74)](a % 4, 8), 4))), r[n(64)](15 & i.wWwRM(e[a >> 2], i[n(47)](a % 4, 8))));
                    return o
                }
                return i[t(0)]((function(e) {
                    var n = t;
                    return i[n(144)](h, i[n(76)](o, i.vyNVU(p, e), 16 * e[n(108)]))
                }
                ), e)
            }

function d(e) {
                var t = u
                  , n = {};
                n[t(214)] = function(e, t) {
                    return e || t
                }
                ,
                n.bWcgB = function(e, t) {
                    return e * t
                }
                ,
                n[t(227)] = "ABCDEFGHJK" + t(209) + "Zabcdefhij" + t(215) + "z2345678";
                for (var r = n, o = "1|3|0|4|2|5"[t(188)]("|"), a = 0; ; ) {
                    switch (o[a++]) {
                    case "0":
                        var s = l[t(261)];
                        continue;
                    case "1":
                        e = r[t(214)](e, 32);
                        continue;
                    case "2":
                        for (i = 0; i < e; i++)
                            c += l[t(245)](Math[t(233)](r.bWcgB(Math.random(), s)));
                        continue;
                    case "3":
                        var l = r[t(227)];
                        continue;
                    case "4":
                        var c = "";
                        continue;
                    case "5":
                        return c
                    }
                    break
                }
            }

window[u(208)] = function(e) {
                var t = u
                  , r = {};
                r.TGmSp = t(244) + "ARACTER_ERR",
                r[t(238)] = t(224) + t(250) + "/",
                r[t(205)] = "^([^ ]+( +" + t(230) + t(259),
                r.aYkvo = function(e) {
                    return e()
                }
                ,
                r[t(254)] = function(e, t) {
                    return e % t
                }
                ,
                r.evetF = function(e, t) {
                    return e >> t
                }
                ,
                r.GfTek = t(196),
                r[t(260)] = function(e, t) {
                    return e << t
                }
                ,
                r[t(229)] = function(e, t) {
                    return e | t
                }
                ,
                r[t(242)] = function(e, t) {
                    return e << t
                }
                ,
                r[t(228)] = function(e, t) {
                    return e & t
                }
                ,
                r[t(207)] = function(e, t) {
                    return e << t
                }
                ,
                r[t(202)] = function(e, t) {
                    return e & t
                }
                ,
                r.jdwcO = function(e, t) {
                    return e === t
                }
                ,
                r.kPdGe = t(231),
                r[t(195)] = t(213),
                r[t(201)] = function(e, t) {
                    return e & t
                }
                ,
                r[t(206)] = function(e, t) {
                    return e == t
                }
                ,
                r[t(219)] = function(e, t) {
                    return e + t
                }
                ,
                r[t(220)] = function(e, t) {
                    return e(t)
                }
                ;
                var i = r;
                if (/([^\u0000-\u00ff])/.test(e))
                    throw new Error(i.TGmSp);
                for (var o, a, s, l = 0, c = []; l < e[t(261)]; ) {
                    switch (a = e[t(237)](l),
                    s = i.kukBH(l, 6)) {
                    case 0:
                        // delete window,
                        //delete document,
                        c[t(246)](f[t(245)](i[t(212)](a, 2)));
                        break;
                    case 1:
                        try {
                            "WhHMm" === i[t(198)] || window && c[t(246)](f[t(245)](i.pHtmC(2 & o, 3) | i.evetF(a, 4)))
                        } catch (e) {
                            c[t(246)](f[t(245)](i[t(229)](i.cVCcp(3 & o, 4), a >> 4)))
                        }
                        break;
                    case 2:
                        c[t(246)](f[t(245)](i[t(229)](i[t(242)](15 & o, 2), i.evetF(a, 6)))),
                        c[t(246)](f[t(245)](i[t(228)](a, 63)));
                        break;
                    case 3:
                        c[t(246)](f[t(245)](i[t(212)](a, 3)));
                        break;
                    case 4:
                        c.push(f[t(245)](i[t(229)](i[t(207)](i.OWUOc(o, 4), 6), i[t(212)](a, 6))));
                        break;
                    case 5:
                        c[t(246)](f[t(245)](i[t(229)](i[t(207)](i[t(202)](o, 15), 4), a >> 8))),
                        c.push(f.charAt(i[t(202)](a, 63)))
                    }
                    o = a,
                    l++
                }
                return 0 == s ? i[t(226)](i[t(241)], i[t(195)]) || (c[t(246)](f[t(245)](i[t(201)](o, 3) << 4)),
                c.push("FM")) : i.eMnqD(s, 1) && (c[t(246)](f[t(245)]((15 & o) << 2)),
                c[t(246)]("K")),
                i[t(219)](i.aQCDK(d(15), md5(c[t(234)](""))), i[t(220)](d, 10))
            };

return btoa(value)

};

// console.log(window[u(208)](Date['parse'](new Date).toString()))
// console.log(btoa((Date['parse'](new Date).toString())));

console.log(ff(Date['parse'](new Date).toString()));


```



python代码

```python
import requests,execjs,time

cookies = {
    'Hm_lvt_0362c7a08a9a04ccf3a8463c590e1e2f': '1624102105,1624272874,1624509437,1624509456',
    'Hm_lvt_c99546cf032aaa5a679230de9a95c7db': '1623834924,1624510235,1625125779,1626072108',
    'Hm_lvt_9bcbda9cbf86757998a2339a0437208e': '1623834459,1625125788,1626072117',
    'Hm_lpvt_9bcbda9cbf86757998a2339a0437208e': '1626072117',
    'qpfccr': 'true',
    'no-alert3': 'true',
    'Hm_lpvt_c99546cf032aaa5a679230de9a95c7db': '1626078367',
}

headers = {
    'Proxy-Connection': 'keep-alive',
    'Accept': 'application/json, text/javascript, */*; q=0.01',
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.106 Safari/537.36',
    'X-Requested-With': 'XMLHttpRequest',
    'Referer': 'http://match.yuanrenxue.com/match/16',
    'Accept-Language': 'zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6',
}

js = open('16.js').read()

times = int(time.time() * 1000)
m = execjs.compile(js).call('ff',str(times))
print(m)

params = (
    ('page', '1'),
    ('m', m),
    ('t', str(times)),
)

response = requests.get('http://match.yuanrenxue.com/api/match/16', headers=headers, params=params, cookies=cookies)

print(response.text)
```













